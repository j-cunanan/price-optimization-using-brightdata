<div class="p-6">
    <div class="mb-6">
        <h3 class="text-xl font-semibold text-gray-900 mb-2">{{ keyword.replace('_', ' ').title() }}</h3>
        <p class="text-gray-600">Price and product trends over time</p>
    </div>

    <!-- Price Chart -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <h4 class="text-lg font-medium text-gray-900">Price Trends</h4>
        </div>
        <div class="p-6">
            <canvas id="price-chart" height="100"></canvas>
        </div>
    </div>

    <!-- Product Count Chart -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <h4 class="text-lg font-medium text-gray-900">Product Count Over Time</h4>
        </div>
        <div class="p-6">
            <canvas id="product-chart" height="100"></canvas>
        </div>
    </div>

    <!-- Recent Results Table -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h4 class="text-lg font-medium text-gray-900">Recent Results</h4>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Date
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Products
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Price Range
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Platforms
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Actions
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for result in keyword_results %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ result.scraped_at[:19].replace('T', ' ') if result.scraped_at else 'N/A' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">
                                {{ result.total_products }} total
                            </div>
                            <div class="text-sm text-gray-500">
                                {{ result.products_with_price }} with price
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if result.min_price %}
                            <div class="text-sm text-gray-900">
                                ¥{{ "{:,.0f}".format(result.min_price) }} - ¥{{ "{:,.0f}".format(result.max_price) }}
                            </div>
                            <div class="text-sm text-gray-500">
                                Avg: ¥{{ "{:,.0f}".format(result.avg_price) }}
                            </div>
                            {% else %}
                            <span class="text-sm text-gray-400">No prices</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex flex-wrap gap-1">
                                {% for platform in result.platforms %}
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium
                                           {% if platform == 'amazon_jp' %}bg-orange-100 text-orange-800{% endif %}
                                           {% if platform == 'rakuten' %}bg-red-100 text-red-800{% endif %}
                                           {% if platform == 'mercari' %}bg-pink-100 text-pink-800{% endif %}
                                           {% if platform == 'yahoo_shopping' %}bg-purple-100 text-purple-800{% endif %}">
                                    {{ platform.replace('_', ' ').title() }}
                                </span>
                                {% endfor %}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button 
                                class="text-blue-600 hover:text-blue-900"
                                hx-get="/api/products/{{ result.filename }}"
                                hx-target="#modal-content"
                                onclick="openModal()"
                            >
                                <i class="fas fa-eye mr-1"></i>
                                View Products
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Price Chart
const priceCtx = document.getElementById('price-chart').getContext('2d');
new Chart(priceCtx, {
    type: 'line',
    data: {
        labels: [{% for result in keyword_results %}'{{ result.scraped_at[:10] if result.scraped_at else "" }}'{% if not loop.last %},{% endif %}{% endfor %}],
        datasets: [{
            label: 'Min Price',
            data: [{% for result in keyword_results %}{{ result.min_price or 'null' }}{% if not loop.last %},{% endif %}{% endfor %}],
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4
        }, {
            label: 'Average Price',
            data: [{% for result in keyword_results %}{{ result.avg_price or 'null' }}{% if not loop.last %},{% endif %}{% endfor %}],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4
        }, {
            label: 'Max Price',
            data: [{% for result in keyword_results %}{{ result.max_price or 'null' }}{% if not loop.last %},{% endif %}{% endfor %}],
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '¥' + value.toLocaleString();
                    }
                }
            }
        },
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ¥' + context.parsed.y.toLocaleString();
                    }
                }
            }
        }
    }
});

// Product Count Chart
const productCtx = document.getElementById('product-chart').getContext('2d');
new Chart(productCtx, {
    type: 'bar',
    data: {
        labels: [{% for result in keyword_results %}'{{ result.scraped_at[:10] if result.scraped_at else "" }}'{% if not loop.last %},{% endif %}{% endfor %}],
        datasets: [{
            label: 'Total Products',
            data: [{% for result in keyword_results %}{{ result.total_products or 0 }}{% if not loop.last %},{% endif %}{% endfor %}],
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgb(59, 130, 246)',
            borderWidth: 1
        }, {
            label: 'Products with Price',
            data: [{% for result in keyword_results %}{{ result.products_with_price or 0 }}{% if not loop.last %},{% endif %}{% endfor %}],
            backgroundColor: 'rgba(34, 197, 94, 0.8)',
            borderColor: 'rgb(34, 197, 94)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
